<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="ja" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.120.2">
<link rel="canonical" type="text/html" href="https://cu-milab.github.io/ai-robot/robotics/">
<link rel="alternate" type="application/rss&#43;xml" href="https://cu-milab.github.io/ai-robot/robotics/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/ai-robot/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/ai-robot/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/ai-robot/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/ai-robot/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/ai-robot/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/ai-robot/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/ai-robot/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/ai-robot/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/ai-robot/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/ai-robot/favicons/android-192x192.png" sizes="192x192">

<title>ロボティクス演習 | 中部大学AIロボティクス学科</title>
<meta name="description" content="A Docsy example sites">
<meta property="og:title" content="ロボティクス演習" />
<meta property="og:description" content="A Docsy example sites" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://cu-milab.github.io/ai-robot/robotics/" /><meta property="og:image" content="https://cu-milab.github.io/ai-robot/robotics/_print/featured-background.jpg"/><meta property="og:site_name" content="Goldydocs2" />

<meta itemprop="name" content="ロボティクス演習">
<meta itemprop="description" content="A Docsy example sites"><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cu-milab.github.io/ai-robot/robotics/_print/featured-background.jpg"/>
<meta name="twitter:title" content="ロボティクス演習"/>
<meta name="twitter:description" content="A Docsy example sites"/>




<link rel="preload" href="/ai-robot/scss/main.min.62ea14fa9166ac179c866e06e1ad3975aebe925c9a1168b02db611ca55de8c87.css" as="style">
<link href="/ai-robot/scss/main.min.62ea14fa9166ac179c866e06e1ad3975aebe925c9a1168b02db611ca55de8c87.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.3.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VD6HCF8XZQ"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-VD6HCF8XZQ');
}
</script>
  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar navbar-dark js-navbar-scroll">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/ai-robot/"><span class="navbar-brand__logo navbar-logo"></span><span class="navbar-brand__name">中部大学AIロボティクス学科</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/ai-robot/robotics/"><span>ロボティクス演習</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/ai-robot/project/"><span>プロジェクト演習</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/ai-robot/ros/"><span>ロボットオペレーティングシステム</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/ai-robot/laboratory/"><span>ロボティクスラボ</span></a>
      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
これは、このセクションの複数ページの印刷可能なビューです。
<a href="#" onclick="print();return false;">印刷するには、ここをクリックしてください</a>.
</p><p>
<a href="/ai-robot/robotics/">このページの通常のビューに戻る</a>.
</p>
</div>



<h1 class="title">ロボティクス演習</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-6d2c91f18707c69ffd36c4b0b3e8f472">ROS2のインストール</a></li>


    
  
    
    
	
<li>2: <a href="#pg-650bb202ce1b4f6d6a876ce3b27432b1">トピック通信の理解</a></li>


    
  
    
    
	
<li>3: <a href="#pg-9a925659560c7313ce8bbca2fc7e1b5d">ワークスペースとパッケージの作成</a></li>


    
  
    
    
	
<li>4: <a href="#pg-8474e75344ea354e73a1620b4e22b2a0">トピック通信の実装</a></li>


    
  
    
    
	
<li>5: <a href="#pg-c88940aa0ba198690c51f542a09c55a6">複数の端末を用いた分散処理</a></li>


    
  

    </ul>


<div class="content">
      <h2 id="ロボティクス演習の趣旨">ロボティクス演習の趣旨</h2>
<p>本演習では，ROS2によりシステムを構築する際に必要となる仕組み及び通信方法の理解，及びプログラミングによる実装方法までを学びます．
ロボティクス演習ではシミュレータを用いて，後半のプロジェクト演習では実機であるTurtlebot3を主体として実践的に学びます．
なお，本演習では「ロボットオペレーティングシステム」の講義と連動しています．
講義の進捗具合によっては，演習及び講義の内容を入れ替えることがあります．</p>
<h2 id="実習環境">実習環境</h2>
<p>下記の環境で実習することを前提とします．</p>
<ul>
<li>Ubuntu
<ul>
<li>Ubuntu22.04 (デュアルブート環境)</li>
<li>VM環境下で構築されたUbuntu22.04</li>
</ul>
</li>
<li>ROS2 Humble</li>
</ul>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6d2c91f18707c69ffd36c4b0b3e8f472">1 - ROS2のインストール</h1>
    <div class="lead">各自のノートPCにROS2をインストールします．</div>
	<h2 id="目的">目的</h2>
<p>各自のノートPCにRobot Operating System2(ROS2) Humble Hawksbillをインストールして実習環境を整えます．
インストールには1週を想定していますが，正常にインストールが完了できなかった方には個別で対応します．
2週目までには必ずROS2が使用できる状態にしましょう．</p>
<h2 id="インストール手順">インストール手順</h2>
<p>Ubuntu22.04上で動作するROS2をインストールします．
Ubuntu22.04で利用できるROS2のディストリビューションは，Iron IrwiniとHumble Hawksbillの2つです．
Iron Irwiniのサポート期限は2024年11月，Humble Hawksbillは2027年5月です．
Iron Irwiniの方が新しいですが，サポート期限が長いHumble Hawksbillをインストールします．
ROS2をインストールするには下記の2つの方法があります．</p>
<ol>
<li>ソースコードをビルドしてインストール</li>
<li>パッケージ管理ツール(apt)を用いてインストール</li>
</ol>
<p>今回は2. のパッケージ管理ツールを用いてROS2をインストールします．</p>
<h3 id="ローケル設定の確認">ローケル設定の確認</h3>
<p>ROS2では，文字コードとしてUTF-8がサポートされています．
各自のコンピュータで設定されている言語及び文字コードを確認します．
ターミナルを起動して下記のコマンドを実行してください．</p>


<div class="alert alert-primary" role="alert">


    冒頭の$は端末で入力するコマンドを表しています．$以降を入力してください．

</div>

<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> locale
</span></span></code></pre></td></tr></table>
</div>
</div><p>上記のコマンドの実行すると下記のような出力が得られます．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#000;font-style:italic">LANG=ja_JP.UTF-8
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LANGUAGE=
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LC_CTYPE=&#34;ja_JP.UTF-8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LC_NUMERIC=&#34;ja_JP.UTF-8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LC_TIME=&#34;ja_JP.UTF-8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LC_COLLATE=&#34;ja_JP.UTF-8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LC_MONETARY=&#34;ja_JP.UTF-8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LC_MESSAGES=&#34;ja_JP.UTF-8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LC_PAPER=&#34;ja_JP.UTF-8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LC_NAME=&#34;ja_JP.UTF-8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LC_ADDRESS=&#34;ja_JP.UTF-8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LC_TELEPHONE=&#34;ja_JP.UTF-8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LC_MEASUREMENT=&#34;ja_JP.UTF-8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LC_IDENTIFICATION=&#34;ja_JP.UTF-8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LC_ALL=
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>「=」の左側はロケール環境変数と呼ばれる変数です．
詳細な説明は省略しますが，複数のロケール環境変数に「&ldquo;ja_JP.UTF-8&rdquo;」が設定されています．
「ja_JP」は表示言語が日本語であることを意味し，「UTF-8」はUnicodeで使用できる文字符号化形式を表しています．
「UTF-8」が設定されていない場合には，下記のコマンドにより設定しましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> sudo apt update <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> sudo apt install locales
</span></span><span style="display:flex;"><span><span style="color:#8f5902">$</span> sudo locale-gen  ja_JP ja_JP.UTF-8
</span></span><span style="display:flex;"><span><span style="color:#8f5902">$</span> sudo update-locale <span style="color:#000">LC_ALL</span><span style="color:#ce5c00;font-weight:bold">=</span>ja_JP.UTF-8 <span style="color:#000">LANG</span><span style="color:#ce5c00;font-weight:bold">=</span>ja_JP.UTF-8
</span></span></code></pre></td></tr></table>
</div>
</div>

<div class="alert alert-primary" role="alert">


    コマンド実行時にroot権限を与える「sudo」を使用する際はパスワードが要求されます．
その際，セキュリティ対策のため，キーボードにより文字を入力しても画面には表示されないので注意してください．

</div>

<p>実行後，ロケール環境変数に「&ldquo;ja_JP.UTF-8&rdquo;」が設定されたことを確認してください．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> locale
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="リポジトリの登録">リポジトリの登録</h3>
<p>ROS2はUbuntuの公式リポジトリ以外からダウンロードする必要があるため，
外部のリポジトリを登録する必要があります．
下記のコマンドによりuniverseリポジトリ(特定のコミュニティが管理するオープンソースソフトウェア)が利用できる状態にしましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> sudo apt install software-properties-common
</span></span><span style="display:flex;"><span><span style="color:#8f5902">$</span> sudo add-apt-repository universe
</span></span></code></pre></td></tr></table>
</div>
</div><p>指定したURLにアクセスするためにcurlコマンドをインストールし，公開鍵(gpgファイル)を所定のディレクトリに保存します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> sudo apt update <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> sudo apt install curl -y
</span></span><span style="display:flex;"><span><span style="color:#8f5902">$</span> sudo curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key -o /usr/share/keyrings/ros-archive-keyring.gpg
</span></span></code></pre></td></tr></table>
</div>
</div><p>リポジトリ情報を管理するsources.listにROS2をインストールするためのリポジトリを加えます．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;deb [arch=</span><span style="color:#204a87;font-weight:bold">$(</span>dpkg --print-architecture<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06"> signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu </span><span style="color:#204a87;font-weight:bold">$(</span>. /etc/os-release <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#204a87">echo</span> <span style="color:#000">$UBUNTU_CODENAME</span><span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06"> main&#34;</span> <span style="color:#000;font-weight:bold">|</span> sudo tee /etc/apt/sources.list.d/ros2.list &gt; /dev/null
</span></span></code></pre></td></tr></table>
</div>
</div><p>リポジトリを追加した後，下記のコマンドによりインストール可能なパッケージのリストを更新し，最新のパッケージに更新します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> sudo apt update
</span></span><span style="display:flex;"><span><span style="color:#8f5902">$</span> sudo apt upgrade
</span></span></code></pre></td></tr></table>
</div>
</div>

<div class="alert alert-warning" role="alert">


    ROS2をインストールする前に必ずインストール済みのソフトウェアを更新してください．
この作業を怠ると，パッケージの依存関係でトラブルが発生する可能性があります．

</div>

<h3 id="ros2のインストール">ROS2のインストール</h3>
<p>ROS2をインストールする間にインストール済みのソフトウェアを更新します．
幾つかのインストール形態がありますが，今回は多数のツールや通信ライブラリ，ビルド関連のパッケージが含まれているものをインストールします．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> sudo apt install ros-humble-desktop
</span></span></code></pre></td></tr></table>
</div>
</div><p>これでインストール完了です．
ROS2は「/opt/ros/」にディストリビューション単位でインストールされます．</p>
<h2 id="環境変数の設定">環境変数の設定</h2>
<p>ソフトウェアをインストールしたパスの設定を行います．
ubuntuでは，コマンド実行時に特定のディレクトリ内に実行ファイルが存在するかを探します．
特定のディレクトリのパスをコマンドサーチパスと呼び，環境変数PATHによって設定されています．
echoコマンドによりPATHにどのディレクトリが設定されているか確認します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">echo</span> <span style="color:#000">$PATH</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/snap/bin
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ROS2は「/opt/ros/」にインストールされますが，上記の結果より環境変数PATHに含まれていないことがわかります．
このままでは使いにくいため，PATHにROS2がインストールされたディレクトリまでのパスを追加します．
幾つかの方法がありますが，ターミナル起動時に読み込まれる「.bashrc」ファイル内でパスを追加する設定を行います．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;source /opt/ros/humble/setup.bash&#34;</span> &gt;&gt; ~/.bashrc
</span></span><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">source</span> ~/.bashrc
</span></span></code></pre></td></tr></table>
</div>
</div>

<div class="alert alert-primary" role="alert">


    上記のコマンドを間違えて入力した際には，エディタ(vim等)で<code>.bashrc</code>ファイルを適切に編集してください．
追加した内容は<code>.bashrc</code>ファイルの最後に記載されます．

</div>

<p>上記を実行後，ターミナルを再起動してからPATHの内容を確認します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">echo</span> <span style="color:#000">$PATH</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/opt/ros/humble/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/snap/bin
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>PATHの冒頭にROS2をインストールしたディレクトリまでのパスが追加されました．</p>
<p>次に環境変数ROS_LOCALHOST_ONLYを設定します．
ROS2では，同一のネットワーク内で起動しているノードを自動的に検出します．
この仕組みは簡単に分散処理ができる一方，複数の端末で実習を行うと他の端末に影響を与える問題が発生します．
そのため，ROS2における通信をlocalhost(自身のコンピュータ)に限定する設定を行います．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;export ROS_LOCALHOST_ONLY=1&#34;</span> &gt;&gt; ~/.bashrc
</span></span></code></pre></td></tr></table>
</div>
</div>

<div class="alert alert-primary" role="alert">


    他の端末と通信する際には，上記の設定を無効化する必要があります．
上記のように設定すると<code>.bashrc</code>ファイルに追記されますので，必要に応じて削除してください．
また，<code>ROS_DOMAIN_ID</code>により通信する端末を限定することも可能です．

</div>

<h2 id="動作確認">動作確認</h2>
<p>ROS2が正常に利用できる状態であるかを確認します．
下記のコマンドの意味は次週以降の講義で扱います．
ターミナルで下記のコマンドを実行してください．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 run turtlesim turtlesim_node
</span></span></code></pre></td></tr></table>
</div>
</div>

<div class="alert alert-warning" role="alert">


    ターミナルにてqt関連の警告が表示されますが無視して構いません．

</div>

<p>正常に起動するとシミュレータの画面が表示されます．
その際，中央に表示されている亀の絵が例と異なっていても問題はありません．
終了する場合には，上記のコマンドを実行したターミナルをアクティブな状態とし，「Ctrl」キーと「C」キーを同時に押してください．</p>
<p><img src="turtlesim.png#center" alt="シミュレータ画像が表示されます"></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-650bb202ce1b4f6d6a876ce3b27432b1">2 - トピック通信の理解</h1>
    <div class="lead">ROS2におけるトピック通信について学びます．</div>
	<h2 id="目的">目的</h2>
<p>ROS2のシステムで利用されているトピック通信について学びます．
講義の前半では座学形式でトピック通信の仕組みについて理解し，
後半ではコマンドラインツールと簡易シミュレータturtlesimを用いた演習により，ノードやトピックの概念，通信方法を理解します．</p>
<h2 id="ros2のコマンドライン">ROS2のコマンドライン</h2>
<p>Ubuntuでは，ターミナルに文字列を入力して操作することが基本となります．
ターミナルに入力する文字列のことをコマンドラインと呼びます．
まずはROS2のコマンドラインを確認するために，下記のコマンドラインをターミナルで実行してください．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">usage: ros2 [-h] [--use-python-default-buffering]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    Call `ros2 &lt;command&gt; -h` for more detailed usage. ...
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">ros2 is an extensible command-line tool for ROS 2.
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">options:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  -h, --help    show this help message and exit
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --use-python-default-buffering
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                Do not force line buffering in stdout and instead use
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                the python default buffering, which might be affected
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                by PYTHONUNBUFFERED/-u and depends on whatever stdout
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                is interactive or not
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">Commands:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  action     Various action related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  bag        Various rosbag related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  component  Various component related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  daemon     Various daemon related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  doctor     Check ROS setup and other potential issues
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  interface  Show information about ROS interfaces
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  launch     Run a launch file
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  lifecycle  Various lifecycle related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  multicast  Various multicast related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  node       Various node related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  param      Various param related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  pkg        Various package related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  run        Run a package specific executable
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  security   Various security related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  service    Various service related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  topic      Various topic related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  wtf        Use `wtf` as alias to `doctor`
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">  Call `ros2 &lt;command&gt; -h` for more detailed usage.
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ROS2のコマンドラインは，<code>ROS2</code>という単語にサブコマンドを加えることで，様々なコマンドラインを実行することができるようになっています．
また，上記のようにオプションとして<code>-h</code>を加えることで，コマンドの仕様を確認することができますので，必要に応じて確認しましょう．</p>
<h2 id="ノードの起動と確認">ノードの起動と確認</h2>
<p>まずはノードを起動します．
ノードを起動するために，先ほど調べたサブコマンドの中の<code>run</code>を使用します．
<code>run</code>の使用を確認しましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 run -h
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">usage: ros2 run [-h] [--prefix PREFIX] package_name executable_name ...
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">Run a package specific executable
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">positional arguments:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  package_name     Name of the ROS package
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  executable_name  Name of the executable
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  argv             Pass arbitrary arguments to the executable
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">options:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  -h, --help       show this help message and exit
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --prefix PREFIX  Prefix command, which should go before the executable. Command must be wrapped in quotes if it contains spaces (e.g. --prefix &#39;gdb -ex run
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                   --args&#39;).
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ノードを起動するためには，<code>ros2 run</code>の後に<code>package_name</code>と<code>executable_name</code>を入力すれば良いことがわかります．
今回は<code>package_name</code>に<code>turtlesim</code>，<code>executable_name</code>に<code>turtlesim_node</code>とし，
簡易シミュレータであるturtlesimを起動します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 run turtlesim turtlesim_node
</span></span></code></pre></td></tr></table>
</div>
</div><p>上記のコマンドを実行すると簡易シミュレータTurtlesimが起動します．</p>
<p><img src="turtlesim.png#center" alt="シミュレータ画像が表示されます"></p>


<div class="alert alert-primary" role="alert">


    Turtlesimを実行したターミナルはコマンドラインを受け付けない状態になっています．
終了する場合には，<code>Ctrl</code>キーと<code>c</code>キーを同時に入力してください．

</div>

<p>次に起動したノードの情報を確認しましょう．
ノードの情報を確認するために，まずはサブコマンド<code>node</code>の仕様を確認します．
新しいターミナルを起動して下記のコマンドを実行してください．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 node -h
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">usage: ros2 node [-h] Call `ros2 node &lt;command&gt; -h` for more detailed usage. ...
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">Various node related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">options:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  -h, --help            show this help message and exit
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">Commands:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  info  Output information about a node
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  list  Output a list of available nodes
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">  Call `ros2 node &lt;command&gt; -h` for more detailed usage.
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>ros2 node</code>では，<code>info</code>と<code>list</code>が用意されていることがわかります．
まずは<code>list</code>により，アクティブなノードの一覧を表示しましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span>ros2 node list 
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/turtlesim
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上記の結果から<code>run</code>コマンドにより起動した<code>/turtlesim</code>が起動していることがわかります．
次に<code>info</code>コマンドによりノードの詳細な情報を調べてみましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 node info /turtlesim 
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/turtlesim
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  Subscribers:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /parameter_events: rcl_interfaces/msg/ParameterEvent
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /turtle1/cmd_vel: geometry_msgs/msg/Twist
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  Publishers:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /parameter_events: rcl_interfaces/msg/ParameterEvent
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /rosout: rcl_interfaces/msg/Log
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /turtle1/color_sensor: turtlesim/msg/Color
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /turtle1/pose: turtlesim/msg/Pose
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  Service Servers:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /clear: std_srvs/srv/Empty
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /kill: turtlesim/srv/Kill
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /reset: std_srvs/srv/Empty
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /spawn: turtlesim/srv/Spawn
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /turtle1/set_pen: turtlesim/srv/SetPen
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /turtle1/teleport_absolute: turtlesim/srv/TeleportAbsolute
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /turtle1/teleport_relative: turtlesim/srv/TeleportRelative
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /turtlesim/describe_parameters: rcl_interfaces/srv/DescribeParameters
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /turtlesim/get_parameter_types: rcl_interfaces/srv/GetParameterTypes
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /turtlesim/get_parameters: rcl_interfaces/srv/GetParameters
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /turtlesim/list_parameters: rcl_interfaces/srv/ListParameters
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /turtlesim/set_parameters: rcl_interfaces/srv/SetParameters
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /turtlesim/set_parameters_atomically: rcl_interfaces/srv/SetParametersAtomically
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  Service Clients:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">  Action Servers:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /turtle1/rotate_absolute: turtlesim/action/RotateAbsolute
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  Action Clients:
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>info</code>コマンドにより指定したノードが購読するトピック，配信するトピック，
サービス通信とアクション通信のサーバ及びクライアントの一覧を出力することができます．
/turtlesimノードは，2つのトピックを購読し，4つのトピックを配信していることがわかります．
トピック名の後(:の後)にはメッセージの型も表示されます．
<code>info</code>は便利なコマンドですので使えるようになりましょう．</p>
<h2 id="トピック通信">トピック通信</h2>
<p>ここまでは<code>ros2 node</code>に関連したコマンドを学びました．
次は<code>ros2 topic</code>に関連したコマンドを学びます．</p>
<h3 id="トピックの確認">トピックの確認</h3>
<p>/turtlesimノード単体ではトピック通信ができないため，もう1つノードを起動します．
新しいターミナルを起動し，下記のノードを実行しましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 run turtlesim turtle_teleop_key 
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Reading from keyboard
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">---------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Use arrow keys to move the turtle.
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Use G|B|V|C|D|E|R|T keys to rotate to absolute orientations. &#39;F&#39; to cancel a rotation.
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">&#39;Q&#39; to quit.
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上記のノードを実行することでキーボードによりロボット(亀)を操作できます．
キーボードの各キーに対応してロボットを動かします．</p>


<div class="alert alert-warning" role="alert">


    /turtle_teleop_keyを起動したターミナルがアクティブになった状態でしか操作できないので注意してください．

</div>

<p>新たにノードを起動したので，起動しているノードは2つになっているはずです．
先ほどの方法で確認しましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 node list 
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/teleop_turtle
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/turtlesim
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>次にトピックに関連したコマンドを学びます．
まずは<code>ros2 topic</code>のヘルプを見てみましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 topic -h
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">usage: ros2 topic [-h] [--include-hidden-topics]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                  Call `ros2 topic &lt;command&gt; -h` for more detailed usage. ...
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">Various topic related sub-commands
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">options:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  -h, --help            show this help message and exit
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --include-hidden-topics
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        Consider hidden topics as well
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">Commands:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  bw     Display bandwidth used by topic
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  delay  Display delay of topic from timestamp in header
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  echo   Output messages from a topic
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  find   Output a list of available topics of a given type
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  hz     Print the average publishing rate to screen
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  info   Print information about a topic
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  list   Output a list of available topics
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  pub    Publish a message to a topic
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  type   Print a topic&#39;s type
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>ros2 topic</code>のサブコマンドは9つあります．
ここではトピック通信を理解するために最低限のサブコマンドしか学びませんが，他にも重要なサブコマンドが多いです．
使えるようになるとトピック通信をより深く理解できますので，講義で扱わないサブコマンドも習得しましょう．</p>
<p>9つあるサブコマンドの中から，まずは<code>list</code>を用いてアクティブなトピックの一覧を取得しましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 topic list 
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/parameter_events
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/rosout
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/turtle1/cmd_vel
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/turtle1/color_sensor
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/turtle1/pose
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上記の出力から5つのトピックが配信，購読されていることがわかります．
ここでは，5つあるトピックの中から<code>/turtle1/cmd_vel</code>に焦点を当てて話を進めます．</p>
<h3 id="トピックの購読">トピックの購読</h3>
<p>サブコマンド<code>echo</code>を用いてターミナルで指定した<code>/turtle1/cmd_vel</code>を購読しましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 topic <span style="color:#204a87">echo</span> /turtle1/cmd_vel
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">linear:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  x: 2.0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  y: 0.0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  z: 0.0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">angular:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  x: 0.0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  y: 0.0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  z: 0.0
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>コマンドを実行しただけでは何も出力されないことから，通常は通信が発生していないことがわかります．
このままではターミナルでトピックを購読できないので，先ほど起動したロボットをキーボードで操作するノードを用いてロボットを動かしましょう．
ロボットを操作すると，ターミナルで購読したトピックの情報が出力されます．</p>
<p><img src="topic_echo.png" alt="ターミナルでトピックを購読している様子"></p>
<p>ロボットのlinear及びangularのx，y，zが出力されました．
linearは並進速度，angularは角速度を表します．
このことから，キーボードでロボットを操作するノード<code>turtle_teleop_key</code>からトピック<code>/turtle1/cmd_vel</code>が配信され，そのトピックを<code>turtlesim_node</code>が受け取りロボットが動いていることがわかります．
どのキーがロボットのどの動きに対応しているか確認しましょう．</p>
<p>ubuntuにて上記のような画面のスクリーンショットを得る方法は幾つかあります．
ここでは<code>gnome-screenshot</code>を用いた方法を紹介します．
まずは<code>gnome-screenshot</code>をインストールしましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> sudo apt install gnome-screenshot
</span></span></code></pre></td></tr></table>
</div>
</div><p>インストール後，下記のコマンドで画面のスクリーンショットを得ることができます．
スクリーンショットはホームディレクトリにあるPicturesディレクトリに保存されます．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> gnome-screenshot
</span></span></code></pre></td></tr></table>
</div>
</div><p>画面の一部分のみを保存したい場合には，下記のコマンドを実行します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> gnome-screenshot -a
</span></span></code></pre></td></tr></table>
</div>
</div><p>上記のコマンドを実行するとカーソルが十字になります．
この状態で画像として保存した領域をドラッグすると，選択した領域のみが画像として保存されます．</p>
<h3 id="メッセージの確認">メッセージの確認</h3>
<p>ノード間で通信するためには，お互いが同じメッセージ型で配信，購読しなければなりません．
メッセージの型名からどのようなデータをやり取りするかを調べましょう．
まずは，サブコマンド<code>type</code>を用いてトピック<code>/turtle1/cmd_vel</code>と対応するメッセージの型を確認します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 topic <span style="color:#204a87">type</span> /turtle1/cmd_vel 
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">geometry_msgs/msg/Twist
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>トピック<code>/turtle1/cmd_vel</code>は<code>geometry_msgs/msg/Twist</code>というメッセージ型を使用することがわかりました．
次に<code>geometry_msgs/msg/Twist</code>というメッセージ型が，どのようなデータを通信するかを確認するために，<code>interface</code>コマンドの<code>show</code>を用いて調べます．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 interface show geometry_msgs/msg/Twist
</span></span><span style="display:flex;"><span><span style="color:#8f5902">#</span> This expresses velocity in free space broken into its linear and angular parts.
</span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">Vector3  linear
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">	float64 x
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">	float64 y
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">	float64 z
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Vector3  angular
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">	float64 x
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">	float64 y
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">	float64 z
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>少しわかりにくいですが，メッセージ型<code>geometry_msgs/msg/Twist</code>は，入れ子の形で<code>Vector3</code>というメッセージのlinear及びangularで構成されていることがわかります．
<code>Vector3</code>は，それぞれが64ビットのfloat型の変数を3つ持っていることがわかります．
念のため，先ほどと同じ方法でメッセージ型<code>Vector3</code>を調べてみます．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 interface show geometry_msgs/msg/Vector3
</span></span><span style="display:flex;"><span><span style="color:#8f5902">#</span> This represents a vector in free space.
</span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#8f5902">#</span> This is semantically different than a point.
</span></span><span style="display:flex;"><span><span style="color:#8f5902">#</span> A vector is always anchored at the origin.
</span></span><span style="display:flex;"><span><span style="color:#8f5902">#</span> When a transform is applied to a vector, only the rotational component is applied.
</span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">float64 x
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">float64 y
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">float64 z
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>先ほど調べた通り，64ビットのfloat型の変数を3つで構成されていることが確認できました．</p>
<h3 id="トピックの配信">トピックの配信</h3>
<p>最後にターミナルからトピックを配信する方法を学びます．
配信には，<code>topic</code>コマンドのサブコマンドである<code>pub</code>を使用します．
<code>pub</code>は使い方が少し複雑ですのでヘルプを確認しましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 topic pub -h
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">usage: ros2 topic pub [-h] [-r N] [-p N] [-1 | -t TIMES] [-w WAIT_MATCHING_SUBSCRIPTIONS]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                      [--keep-alive N] [-n NODE_NAME]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                      [--qos-profile {unknown,system_default,sensor_data,services_default,parameters,parameter_events,action_status_default}]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                      [--qos-depth N] [--qos-history {system_default,keep_last,keep_all,unknown}]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                      [--qos-reliability {system_default,reliable,best_effort,unknown}]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                      [--qos-durability {system_default,transient_local,volatile,unknown}]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                      [--spin-time SPIN_TIME] [-s]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                      topic_name message_type [values]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">Publish a message to a topic
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">positional arguments:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  topic_name            Name of the ROS topic to publish to (e.g. &#39;/chatter&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  message_type          Type of the ROS message (e.g. &#39;std_msgs/String&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  values                Values to fill the message with in YAML format (e.g. &#39;data: Hello World&#39;),
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        otherwise the message will be published with default values
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">options:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  -h, --help            show this help message and exit
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  -r N, --rate N        Publishing rate in Hz (default: 1)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  -p N, --print N       Only print every N-th published message (default: 1)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  -1, --once            Publish one message and exit
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  -t TIMES, --times TIMES
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        Publish this number of times and then exit
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  -w WAIT_MATCHING_SUBSCRIPTIONS, --wait-matching-subscriptions WAIT_MATCHING_SUBSCRIPTIONS
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        Wait until finding the specified number of matching subscriptions.
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        Defaults to 1 when using &#34;-1&#34;/&#34;--once&#34;/&#34;--times&#34;, otherwise defaults to 0.
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --keep-alive N        Keep publishing node alive for N seconds after the last msg (default: 0.1)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  -n NODE_NAME, --node-name NODE_NAME
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        Name of the created publishing node
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --qos-profile {unknown,system_default,sensor_data,services_default,parameters,parameter_events,action_status_default}
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        Quality of service preset profile to publish)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --qos-depth N         Queue size setting to publish with (overrides depth value of --qos-profile
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        option)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --qos-history {system_default,keep_last,keep_all,unknown}
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        History of samples setting to publish with (overrides history value of
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        --qos-profile option, default: keep_last)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --qos-reliability {system_default,reliable,best_effort,unknown}
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        Quality of service reliability setting to publish with (overrides
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        reliability value of --qos-profile option, default: reliable)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --qos-durability {system_default,transient_local,volatile,unknown}
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        Quality of service durability setting to publish with (overrides
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        durability value of --qos-profile option, default: transient_local)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --spin-time SPIN_TIME
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        Spin time in seconds to wait for discovery (only applies when not using an
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        already running daemon)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  -s, --use-sim-time    Enable ROS simulation time
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>オプションが多いので使い方が難しいように見えますが，使用するためには<code>positional arguments</code>に記載されている<code>topic_name</code>と<code>message_type</code>，<code>values</code>が必要であることがわかります．
例えば，Turtlesimのロボットを動かすためには，<code>topic_name</code>には<code>/turtle1/cmd_vel</code>，
<code>message_type</code>には<code>geometry_msgs/msg/Twist</code>，<code>values</code>には並進速度と角速度である<code>Vector3</code>で表される<code>linear</code>と<code>angular</code>を与えます．
<code>values</code>はYAMLと呼ばれるデータ形式で記述します．
実際に下記のコマンドでターミナルから配信してみましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 topic pub /turtle1/cmd_vel geometry_msgs/msg/Twist <span style="color:#4e9a06">&#34;{linear: {x: 1.0, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 2.0}}&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="rqtによる可視化">rqtによる可視化</h2>
<p>コマンドラインを実行してノードやトピックの情報を獲得しました．
扱うノードやトピックの数が少ないため，それぞれの関係を整理できていると思います．
しかし，実際にロボットを動かす場合には，数十のノードやトピックを扱うこともあり，このような場合には，それぞれの関係を把握することが難しくなります．
そこで，ノードやトピックの関係性をグラフにより表現することができるrqt_graphという便利なツールが存在します．</p>
<p>実行中のコマンドを全て終了して各端末で下記を実行しましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span>  ros2 run turtlesim turtlesim_node
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span>  ros2 run turtlesim turtle_teleop_key
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span>  rqt_graph
</span></span></code></pre></td></tr></table>
</div>
</div><p>楕円はノード，四角はトピック，矢印はトピックの配信と購読の関係を表しています．
上記の例では，ノード/teleop_turtleからノード/turtlesimにトピック/turtle1/cmd_velを配信していることがわかります．
このようにノードやトピックの関係性をグラフにより表すことで，それぞれの関係を容易に把握することができます．
非常に便利なツールですので，是非とも有効活用してください．</p>
<p><img src="rqt.png" alt="rqtによるノードとトピックの可視化"></p>
<h2 id="課題">課題</h2>
<ol>
<li>ノードとトピック，メッセージについて説明しなさい．</li>
<li>topicのサブコマンドであるbwとhzについて調べ，説明しなさい．</li>
<li>topicのサブコマンドであるbwとhzにより通信量と周期を調べなさい．</li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9a925659560c7313ce8bbca2fc7e1b5d">3 - ワークスペースとパッケージの作成</h1>
    <div class="lead">colconを用いたワークスペース及びパッケージの作り方，Python言語によるプログラミングする方法学びます．</div>
	<h2 id="目的">目的</h2>
<p>ROS2におけるワークスペース及びパッケージの概念を理解し，演習を通してワークスペースの作成から自作ノードを起動する方法までを学びます．
講義の前半では，座学形式でワークスペースやパッケージ，ビルドツールcolconについて学び，
後半は下記の演習を通して実践的に身につけます．</p>
<h2 id="前準備">前準備</h2>
<p>ROS2がリリースした当初は，amentというビルドシステムによりビルドしていました．
amentはROS2のパッケージのみビルドできるシステムでしたが，ROS2 Bouncyより新たに登場したcolconと呼ばれるビルドツールによりROS1とROS2の両方をビルドできるようになりました．
内部ではROS2パッケージをamentによりビルドしています．
colconはROS2パッケージに含まれていないため，下記のコマンドによりインストールしましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> sudo apt install python3-colcon-common-extensions
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ワークスペースとパッケージの作成">ワークスペースとパッケージの作成</h2>
<h3 id="ワークスペースの作成">ワークスペースの作成</h3>
<p>まずは作業用のディレクトリとなるワークスペースとパッケージを保存するsrcディレクトリを作成します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> mkdir practice_ws
</span></span><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">cd</span> practice_ws
</span></span><span style="display:flex;"><span><span style="color:#8f5902">$</span> mkdir src
</span></span><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">pwd</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/home/[user_name]/practice_ws
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上記のコマンドの <code>pwd</code>はカレントディレクトリまでの絶対パスを表示するコマンドです．
出力結果の <code>[user_name]</code>には，各自が作成したアカウントの名前が入ります．
今後の作業では，頻繁にディレクトリの作成と移動を繰り返すため，
カレントディレクトリまでの絶対パスが把握しにくくなります．
そのような際には，<code>pwd</code> コマンドでカレントディレクトリまでの絶対パスを確認してください．</p>
<p>まだパッケージを作成していませんが，この状態でもビルドできます．
下記のコマンドによりビルドしましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> colcon build
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Summary: 0 packages finished [0.29s]
</span></span></span></code></pre></td></tr></table>
</div>
</div>

<div class="alert alert-warning" role="alert">


    上記のコマンドはワークスペース(今回はpractice_wsディレクトリ)で実行します．
異なるディレクトリでビルドするとディレクトリ構造を崩れる原因となるので注意してください．

</div>

<p>ビルドするとワークスペースに下記の3つのディレクトリが生成されます．</p>
<ul>
<li>build : ビルド時に作成した中間ファイルが保存されます．</li>
<li>install : ビルドにより生成したパッケージがインストール(保存)されます．</li>
<li>log : ビルド時のログが出力されます．</li>
</ul>
<h3 id="パッケージの作成">パッケージの作成</h3>
<p>次にパッケージを作成します．
パッケージは，ワークスペースの <code>src</code> ディレクトリ内に作成します．
<code>cd</code>コマンドで<code>src</code>ディレクトリに移動します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">cd</span> src
</span></span></code></pre></td></tr></table>
</div>
</div><p>パッケージの作成には<code>pkg create</code>コマンドを使用します．
ヘルプを確認してみましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 pkg create -h
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">usage: ros2 pkg create [-h] [--package-format {2,3}]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                       [--description DESCRIPTION] [--license LICENSE]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                       [--destination-directory DESTINATION_DIRECTORY]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                       [--build-type {cmake,ament_cmake,ament_python}]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                       [--dependencies DEPENDENCIES [DEPENDENCIES ...]]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                       [--maintainer-email MAINTAINER_EMAIL]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                       [--maintainer-name MAINTAINER_NAME]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                       [--node-name NODE_NAME] [--library-name LIBRARY_NAME]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                       package_name
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">Create a new ROS 2 package
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">positional arguments:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  package_name          The package name
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">options:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  -h, --help            show this help message and exit
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --package-format {2,3}, --package_format {2,3}
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        The package.xml format.
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --description DESCRIPTION
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        The description given in the package.xml
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --license LICENSE     The license attached to this package; this can be an
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        arbitrary string, but a LICENSE file will only be
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        generated if it is one of the supported licenses (pass
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        &#39;?&#39; to get a list)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --destination-directory DESTINATION_DIRECTORY
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        Directory where to create the package directory
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --build-type {cmake,ament_cmake,ament_python}
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        The build type to process the package with
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --dependencies DEPENDENCIES [DEPENDENCIES ...]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        list of dependencies
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --maintainer-email MAINTAINER_EMAIL
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        email address of the maintainer of this package
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --maintainer-name MAINTAINER_NAME
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        name of the maintainer of this package
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --node-name NODE_NAME
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        name of the empty executable
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  --library-name LIBRARY_NAME
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                        name of the empty library
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>オプションが多いですが，最低でも<code>package_name</code>が必要であることがわかります．
今回は<code>package_name</code>を<code>practice</code>とします．</p>
<p>上記のコマンドには便利なオプションが用意されています．
Python言語でプログラミングする場合には，<code>--build-type ament_python</code>というオプションを加えましょう．
このオプションを加えることで<code>setup.py</code>ファイルが生成され，このファイルでエントリーポイント(プログラム実行時の起点の関数)を記述することができます．
また，このファイルを用いて<code>setuptools</code>により指定したパッケージをインストールすることができるため，自作したパッケージを配布する際に便利です．</p>


<div class="alert alert-primary" role="alert">


    C言語やC++言語でプログラミングする際には， <code>--build-type</code> のオプションに <code>ament_cmake</code> を与えます．

</div>

<p>また，<code>--node-name [node_name]</code>というオプションも加えましょう．
[node_name]で指定した名前のpythonファイルが生成されます．
それでは，下記のコマンドでパッケージを作成します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 pkg create --build-type ament_python --node-name practice_node practice 
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">going to create a new package
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">package name: practice
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">destination directory: /home/yuu/practice_ws/src
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">package format: 3
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">version: 0.0.0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">description: TODO: Package description
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">maintainer: [&#39;yuu &lt;yuu@todo.todo&gt;&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">licenses: [&#39;TODO: License declaration&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">build type: ament_python
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">dependencies: []
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">node_name: practice_node
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating folder ./practice
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating ./practice/package.xml
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating source folder
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating folder ./practice/practice
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating ./practice/setup.py
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating ./practice/setup.cfg
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating folder ./practice/resource
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating ./practice/resource/practice
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating ./practice/practice/__init__.py
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating folder ./practice/test
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating ./practice/test/test_copyright.py
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating ./practice/test/test_flake8.py
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating ./practice/test/test_pep257.py
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">creating ./practice/practice/practice_node.py
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">[WARNING]: Unknown license &#39;TODO: License declaration&#39;.  This has been set in the package.xml, but no LICENSE file has been created.
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">It is recommended to use one of the ament license identitifers:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Apache-2.0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">BSL-1.0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">BSD-2.0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">BSD-2-Clause
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">BSD-3-Clause
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">GPL-3.0-only
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">LGPL-3.0-only
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">MIT
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">MIT-0
</span></span></span></code></pre></td></tr></table>
</div>
</div>

<div class="alert alert-primary" role="alert">


    パッケージを作成した際にライセンスに関する警告が出力されます．
<code>--license</code>オプションでライセンスの種類を指定すると警告が発生せず，LICENSEファイルが自動的に作成されます．
今回は作成したパッケージを配布しないため，ライセンスについては取り扱いません．

</div>

<p>作成したパッケージのディレクトリに移動し，<code>ls</code>コマンドでどのようなディレクトリやファイルが生成されたか確認します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">cd</span> practice
</span></span><span style="display:flex;"><span><span style="color:#8f5902">$</span> ls 
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">package.xml  practice  resource  setup.cfg  setup.py  test
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>幾つかのファイルやディレクトリが作成されたことを確認できます．
今回は<code>--node-name</code>オプションを使用してパッケージを作成したため，pythonファイルが自動的に作成されます．
パッケージと同じ名前の<code>practice</code>ディレクトリの中に指定したファイル名<code>practice_node.py</code>で作成されます．</p>


<div class="alert alert-primary" role="alert">


    pythonファイル以外にもパッケージについて説明する<code>package.xml</code>やパッケージの情報やインストール方法を記述する<code>setup.py</code>などのファイルが生成されます．
特に，<code>setup.py</code>は，プログラム実行時の起点となるエントリーポイントを定義する重要なファイルです．

</div>

<p><code>practice_node.py</code>をエディタで開いてみましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">cd</span> practice
</span></span><span style="display:flex;"><span><span style="color:#8f5902">$</span> vim practice_node.py
</span></span></code></pre></td></tr></table>
</div>
</div><p>初期の状態では，ROSの機能を使用するコードは記述されておらず，
print関数で文字列を出力するのみとなっています．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Hi from practice.&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="colconを用いたビルド">colconを用いたビルド</h2>
<p>まずはこの状態でビルドして実行しましょう．
ビルドするためには，ワークスペースのルートディレクトリ(最上位のディレクトリ)に移動する必要があります．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">cd</span> ../../../
</span></span></code></pre></td></tr></table>
</div>
</div><p>移動したらビルドツールcolconを用いてビルドします．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="background-color:#dfdfdf"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> colcon build
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Starting &gt;&gt;&gt; practice
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">--- stderr: practice                   
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/usr/lib/python3/dist-packages/setuptools/command/install.py:34: SetuptoolsDeprecationWarning: setup.py install is deprecated. Use build and pip and other standards-based tools.
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  warnings.warn(
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">---
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Finished &lt;&lt;&lt; practice [0.43s]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">Summary: 1 package finished [0.73s]
</span></span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#000;font-style:italic">  1 package had stderr output: practice
</span></span></span></code></pre></td></tr></table>
</div>
</div>

<div class="alert alert-primary" role="alert">


    使用しているsetuptoolsのバージョンが58.3よりも新しい場合には警告が表示されます．
Pythonのパッケージ管理ツールがsetup.pyを用いてインストールすることが非推奨となったことが原因です．
setuptoolsをダウングレードすれば警告が表示されなくなりますが，このままでも大きな問題は発生しません．
あまり好ましい状態ではありませんが，ダウングレードによる問題が発生する可能性もあるためこのまま進めます．

</div>

<p>無事にビルドが完了すると，buildとinstall，logディレクトリが生成されます．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span>ls
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">build  install  log  src
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>buildはビルド中に生成されるテンポラリファイル，installは実行時に使用するファイル，logはビルド時の出力を記録したファイルが保存されます．</p>
<h2 id="ノードの起動">ノードの起動</h2>
<h3 id="環境変数の設定">環境変数の設定</h3>
<p>作成したノードを起動する前に，作成したパッケージがどこにあるかをコンピュータに認識させる必要があります．
そのため，sourceコマンドを用いて環境変数を設定します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">source</span> install/local_setup.bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>上記のコマンドにより環境変数<code>$COLCON_PREFIX_PATH</code>にビルド時に生成したインストールファイルのパスが設定されます．
試しに<code>echo</code>コマンドで確認しましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">echo</span> <span style="color:#000">$COLCON_PREFIX_PATH</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/home/yuu/practice_ws/install
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上記のような出力が表示されない場合には環境変数を正しく設定できてません．
何かしらの処理を間違えた，スキップしているので見直しましょう．
なお，新しいターミナルを開いた場合には，環境変数は初期化されます．
ターミナルを開くたびに上記の設定を行ってください．</p>


<div class="alert alert-primary" role="alert">


    <p>ROS2をインストールした際，ホームディレクトリに存在する<code>.bashrc</code>に下記を追加しました．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#000;font-style:italic">source /opt/ros/humble/setup.bash
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>この設定をアンダーレイと呼びます．
これによりROS2のシステムを利用することが可能となります．</p>
<p>これに対して，先ほどのように自作したワークスペースを認識させる操作をオーバーレイと呼びます．
同じ名前のパッケージが存在する場合にはオーバレイのパッケージが優先されます．
普段はアンダーレイ，オーバーレイを意識する必要はありません．</p>


</div>

<h3 id="実行">実行</h3>
<p>それでは実行しましょう．
前回と同様の方法で実行可能です．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 run practice practice_node
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Hi from practice.
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ここまで正しい手順で操作できていると<code>Hi from practice.</code>が出力されます．</p>
<h2 id="ソースコードの変更">ソースコードの変更</h2>
<p>少しだけソースコードを変更しましょう．
エディタでソースファイルを開きます．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> vim src/practice/practice/practice_node.py
</span></span></code></pre></td></tr></table>
</div>
</div><p>2行目の後に下記のコードを追加します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Hello ROS2.&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>先ほどの方法でビルドしても良いですが，幾つか便利なオプションが存在するので使ってみましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> colcon build --packages-select practice --symlink-install
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Starting &gt;&gt;&gt; practice
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">--- stderr: practice                   
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/usr/lib/python3/dist-packages/setuptools/command/install.py:34: SetuptoolsDeprecationWarning: setup.py install is deprecated. Use build and pip and other standards-based tools.
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  warnings.warn(
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">---
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Finished &lt;&lt;&lt; practice [0.42s]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">Summary: 1 package finished [0.71s]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  1 package had stderr output: practice
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>オプション<code>--packages-select [package_name]</code>は，指定したパッケージのみをビルドする方法です．
ワークスペースの規模が大きくなるとビルドに時間を要します．
特定のパッケージのみビルドしたい場合に利用しましょう．
もう1つのオプション<code>--symlink-install</code>は，installディレクトリにファイルをコピーする代わりにシンボリックリンク(ショートカット)を作成します．
これにより，プログラムを変更しても再ビルドが必要なくなります．
作業の効率が高くなり，生産性が向上しますのでぜひ使用しましょう．</p>
<p>改変したプログラムを実行すると下記のような出力が得られます．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 run practice practice_node
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Hi from practice.
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Hello ROS2.
</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8474e75344ea354e73a1620b4e22b2a0">4 - トピック通信の実装</h1>
    <div class="lead">Python言語を用いてトピック通信を実装する方法について学びます．</div>
	<h2 id="目的">目的</h2>
<p>ここまでにトピック通信の仕組み，ROS2によるパッケージやプログラミング方法を学びました．
それら学んだ内容を活用し，簡易シミュレータturtlesimと作成したノード間のトピック通信をプログラミングにより実装します．
これにより，ロボットのローレベルな制御が可能となります．</p>
<h2 id="プログラミングによる配信と購読">プログラミングによる配信と購読</h2>
<h3 id="パッケージの作成">パッケージの作成</h3>
<p>前回の講義で作成したワークスペース <code>practice</code> の中に新たに <code>turtlesim_practice</code> パッケージを作成します．
パッケージ作成時に与えるノードの名前は <code> turtlesim_practice_node</code> とします．
パッケージの作成方法が分からない人は<a href="./../..//ps/587etb0/">前回の講義資料</a>を参考にしてください．</p>
<h3 id="プログラミング">プログラミング</h3>
<p>以前の講義でコマンドラインによってシミュレータ上のロボットを操作しました．
同じ内容をプログラムで実現します．
パッケージを作成した際に生成される<code>turtlesim_practice_node.py</code>に下記のコードを入力しましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">rclpy</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">rclpy.node</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Node</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">geometry_msgs.msg</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Twist</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">turtlesim.msg</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Pose</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">TurtleSim</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Node</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;turtlesim_practice_node&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">twist_pub</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_publisher</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Twist</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;turtle1/cmd_vel&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pose_sub</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_subscription</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Pose</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;turtle1/pose&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pose_callback</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">timer</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_timer</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">timer_callback</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_forward</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">timer_callback</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_forward</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">True</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set_move_vector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0.2</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set_move_vector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">0.2</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_forward</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_forward</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">set_move_vector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">linear_x</span><span style="color:#000;font-weight:bold">):</span>    
</span></span><span style="display:flex;"><span>        <span style="color:#000">twist</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Twist</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">twist</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">linear</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">linear_x</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">twist</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">angular</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">z</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.0</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">twist_pub</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">twist</span><span style="color:#000;font-weight:bold">)</span>        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">pose_callback</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">pose</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_logger</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#39;x:</span><span style="color:#4e9a06">{</span><span style="color:#000">pose</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">x</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">init</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">args</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">node</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">TurtleSim</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">spin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">node</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">node</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">destroy_node</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shutdown</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="実行">実行</h3>
<p>プログラムの中身を理解する前に実行してみましょう．
実行方法は<a href="./../../ps/587etb0/">前回</a>と同じですが，turtlesimシミュレータを起動しないと正しく動作しないので注意してください．
正しく実行できるとロボットが前後運動し，ターミナルにx座標が出力されます．</p>
<p><img src="run.png#center" alt="シミュレータ画像"></p>
<h2 id="プログラムの内容">プログラムの内容</h2>
<p>それでは，作成したプログラム実行時の挙動を確認した上で，プログラムの中身を順番に見ていきましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">rclpy</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">rclpy.node</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Node</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">geometry_msgs.msg</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Twist</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">turtlesim.msg</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Pose</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>まずはプログラム冒頭のimport文です．
1行目のrclpyは，ROS2のpythonモジュールです．
ROS2の機能を使用する場合には必ず必要なモジュールとなります．
2行目は，プログラム中でノードを作成するためにrclpy.nodeモジュールからNodeクラスをimportします．
3，4行目はトピック通信に必要なメッセージファイルをimportしています．
書き方が少し難解ですが，<code>from パッケージ名.msg import メッセージ型</code>と書くと覚えましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">TurtleSim</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Node</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;turtlesim_practice_node&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">twist_pub</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_publisher</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Twist</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;turtle1/cmd_vel&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pose_sub</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_subscription</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Pose</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;turtle1/pose&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pose_callback</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">timer</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_timer</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">timer_callback</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_forward</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">True</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>TurtleSim</code>というクラスを定義してます．
<code>class</code>という単語の後に任意のクラス名を定義できます．
次にコンストラクタを定義しています．
pythonでは<code>def</code>で関数を定義します．
classから始まる構文の中に<code>__init__</code>という関数が定義されています．
これがコンストラクタとなりインスタンスを作成されると最初に実行される関数となります．
<code>__init__</code>の中では，ノードの作成，配信，購読，タイマーのオブジェクトを生成しています．
重要な処理をしているので詳しく見ていきましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;turtlesim_practice_node&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>この1行で<code>turtlesim_practice_node</code>という名前のノードを作成しています．
Pythonでは，あるクラスを元にして同じ構造を持ちつつ拡張したクラスを定義することができます．
元のクラスを基底クラス，拡張することをクラスの継承，継承したクラスを派生クラスと言います．
基底クラスの<code>Node</code>のコンストラクタを呼び出してクラスを継承しています．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">twist_pub</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_publisher</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Twist</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;turtle1/cmd_vel&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>create_publisher</code>を用いて配信者(Publisher)を作成しています．
第1引数はトピック通信で使用するメッセージの型，
第2引数は文字列型で表すトピック名，
第3引数は通信品質(QoS : Quality of Service)です．
QoSプロファイルにより通信の状態に合わせて配信することもできます．
QoSプロファイルは使用せず，デフォルトの10という値にしています．
配信する際に1度バッファに格納し，バッファに格納された古いデータから順番に配信され，配信されたデータは破棄されます．
問題なく通信できる環境であれば常に新しいデータが配信されることになりますが，
ネットワークに遅延等の問題が発生している場合には，バッファにデータが溜まり続けます．</p>
<p>今回の場合は，<code>Twist</code>というメッセージの型を用いて<code>turtle1/cmd_vel</code>という名前のトピックを配信する準備をしています．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pose_sub</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_subscription</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Pose</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;turtle1/pose&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pose_callback</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>create_subscription</code>を用いて購読者(Subscriber)を作成しています．
第1引数はトピック通信で使用するメッセージの型，
第2引数は文字列型で表すトピック名，
第3引数はコールバック関数，
第4引数は通信品質(QoS : Quality of Service)です．
通信品質については先ほどと同じです．</p>
<p>上記の場合には，<code>Pose</code>というメッセージの型を用いた<code>turtle1/pose</code>という名前のトピックを購読した場合，pose_callback関数を実行することになります．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">timer</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_timer</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">timer_callback</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>指定した間隔で動作するタイマーを作成しています．
<code>create_timer</code>の第1引数は繰り返し間隔，第2引数は実行するコールバック関数です．
上記の場合，1.0秒間隔で<code>timer_callback</code>関数を実行することになります．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_forward</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">True</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>後ほど使用するフラグを<code>True</code>で初期化しています．
このフラグは，ロボットが前進するか後退するかを表すフラグとなります．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">timer_callback</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_forward</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">True</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set_move_vector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0.2</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set_move_vector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">0.2</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_forward</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_forward</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>タイマーで指定した間隔で<code>timerCallback</code>関数を実行します．
先ほど初期化した<code>is_forward</code>というフラグが<code>True</code>であれば，引数0.2を伴いset_move_vector関数を実行し，
<code>is_forward</code>が<code>True</code>以外であれば，引数-0.2を伴いset_move_vector関数を実行します．
21行目では，フラグ<code>is_forward</code>を反転させてます．
<code>True</code>であったならば<code>False</code>に，<code>False</code>であったならば<code>True</code>になります．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">set_move_vector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">linear_x</span><span style="color:#000;font-weight:bold">):</span>    
</span></span><span style="display:flex;"><span>        <span style="color:#000">twist</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Twist</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">twist</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">linear</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">linear_x</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">twist</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">angular</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">z</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.0</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">twist_pub</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">twist</span><span style="color:#000;font-weight:bold">)</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><p>並進速度と角速度を0としてトピックを配信します．
linear_xには0.2もしくは-0.2が代入されているため，このトピックをロボットが購読するとロボットは前進もしくは後退します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">pose_callback</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">pose</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_logger</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#39;x:</span><span style="color:#4e9a06">{</span><span style="color:#000">pose</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">x</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>指定したトピックを購読する度に<code>poseCallback</code>を実行します．
pythonのprint関数のように，ROSにはターミナルに表示するためのメソッドが用意されています．
少しわかりにくいですが，基底クラス<code>Node</code>にてget_logger().info()が定義されています．
infoの括弧内は，print関数と同じ書式で記述できます．
今回は<code>turtle1/pose</code>というトピックを購読する度にロボットのx座標を表示しています．</p>
<p>print関数はターミナルに表示するだけですが，上記の書き方によりログファイルにも出力されます．
規模が大きなシステムを構築する場合に，ログファイルからシステムの挙動を確認したいことがあります．
そのような場合にはprint関数ではなく，上記の方法により記述した方が便利です．
get_loggerでは，infoの他にwarningやerror，debug等が用意されています．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">init</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">args</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">node</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">TurtleSim</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">spin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">node</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">node</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">destroy_node</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shutdown</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>34行目で初期化し，35行目でturtleSimクラスのインスタンスを生成しています．
rclpyはROS2のpythonモジュールですので，ROS2の機能を使う場合には必ず初期化が必要です．
35行目のspin関数により待ち状態(終了しない限り実行され続ける)が発生し，必要に応じでコールバック関数が呼び出されます．
37行目はノードを破壊し，38行目で終了処理を行います．</p>
<p>以上でプログラミングにより配信と購読することができます．
前々回に学んだノードやトピック，メッセージの情報をROSのコマンドで取得する方法，
今回学んだトピック通信の実装方法で，ロボットを自律制御することが可能となります．</p>
<h2 id="課題">課題</h2>
<ol>
<li>setMoveVector関数の引数に与える値を変え，その際の挙動を予想しなさい．そして結果と比較しなさい．</li>
<li>購読している全ての情報(ヒント : x座標以外に4つの情報があります)をget_logger().info()により出力しなさい．</li>
<li>ロボットに正四角形の軌跡を描かせるプログラムを作成しなさい．</li>
<li>ロボットを座標(5,5)に移動させなさい．座標は購読した情報を使用すること．</li>
<li>トピック「/turtle1/color_sensor」を購読してget_logger().info()により出力しなさい．</li>
<li>ロボットが直進する際に，スムーズに加速，減速するような加減速制御を行いなさい．</li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c88940aa0ba198690c51f542a09c55a6">5 - 複数の端末を用いた分散処理</h1>
    <div class="lead">端末間のデータ通信について学びます．</div>
	<h2 id="目的">目的</h2>
<p>ROS2では簡単に複数の端末間で分散処理ができるように設計されています．
本演習では，複数の端末で処理する方法について学びます．</p>
<h2 id="仮想マシンを使用している場合の設定">仮想マシンを使用している場合の設定</h2>
<p>VirtualBoxやVMwareなどの仮想マシンを使用している人は，ネットワークの接続設定を行ってから演習に取り組んでください．
デフォルトでは，ネットワークの接続方式が<code>NAT接続</code>となっていますが，<code>ブリッジ接続(ブリッジネットワーク)</code>に変更する必要があります．
また，設定変更を反映するために再起動してください．</p>
<h2 id="ネットワークの設定">ネットワークの設定</h2>
<p>ROS2では，同一ネットワーク内のノードを検出してデータ通信が容易にできる仕組みとなっています．
同一ネットワークとは，各端末が同じルーターに接続された状態を表します．
限定したグループ内だけでデータ通信したい場合には，異なるドメインIDを割り当てる必要があります．
なお，ドメインIDで設定する値の範囲は<code>0~65532</code>となります．
例えば，2人でグループを作成した場合，2人だけが使用するドメインIDを設定することで2端末間だけでデータ通信ができるようになります．
下記は環境変数である<code>ROS_DOMAIN_ID</code>に<code>1</code>という値を設定する場合の例です．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">export</span> <span style="color:#000">ROS_DOMAIN_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>実際に割り当てるドメインIDの値については講義中に指示します．
上記のコマンドを実行したターミナルのみ設定が有効です．
ターミナルを起動する度に上記のコマンドを実行することが手間な場合には，
ホームディレクトリに存在する<code>.bashrc</code>に書き込むことで起動した際に自動的に環境変数が設定されます．</p>
<h2 id="確認">確認</h2>
<p>2人でペアを作り，同じドメインIDに設定した時の挙動を確認します．
1人はシミュレータturtlesimを起動します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 run turtlesim turtlesim_node
</span></span></code></pre></td></tr></table>
</div>
</div><p>もう1人はキーボードでロボットを操作するノードを起動します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 run turtlesim turtle_teleop_key 
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>node list</code>コマンドを用いてお互いが起動したノードが表示されることを確認しましょう．
そして，キーボードを用いてシミュレータ上のロボットを遠隔操作できることを確認してください．</p>
<h2 id="複数端末間でデータ通信を行わない設定">複数端末間でデータ通信を行わない設定</h2>
<p>他の端末とのデータ通信を行わないことを明示的に設定することも可能です．
環境変数<code>ROS_LOCALHOST_ONLY</code>を<code>1</code>に設定します．
これによりローカルホスト(自身の端末のみ)に限定できます．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;export ROS_LOCALHOST_ONLY=1&#34;</span> &gt;&gt; ~/.bashrc
</span></span><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">source</span> ~/.bashrc
</span></span></code></pre></td></tr></table>
</div>
</div>
</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
      </div>
      <div class="col-6 col-sm-4 text-end text-xs-center order-sm-3">
        
      </div>
      <div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2">
        <span>&copy; 2024 中部大学理工学部AIロボティクス学科 All Rights Reserved</span>
        
        
      </div>
    </div>
  </div>
</footer>
    </div>
    
  <script src="/ai-robot/js/main.min.f144e2c5ca4a17d62d06a21473c0b37ce1b36a5f7b700fea1760dc6d55f33bf1.js" integrity="sha256-8UTixcpKF9YtBqIUc8CzfOGzal97cA/qF2DcbVXzO/E=" crossorigin="anonymous"></script>
<script defer src="/ai-robot/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js" integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin="anonymous"></script>
<script src='/ai-robot/js/tabpane-persist.js'></script>

  </body>
</html>
