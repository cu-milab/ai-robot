<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="ja" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.113.0">
<link rel="canonical" type="text/html" href="https://cu-milab.github.io/ai-robot/project/">
<link rel="alternate" type="application/rss&#43;xml" href="https://cu-milab.github.io/ai-robot/project/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/ai-robot/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/ai-robot/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/ai-robot/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/ai-robot/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/ai-robot/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/ai-robot/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/ai-robot/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/ai-robot/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/ai-robot/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/ai-robot/favicons/android-192x192.png" sizes="192x192">

<title>プロジェクト演習 | 中部大学AIロボティクス学科</title>
<meta name="description" content="A Docsy example sites">
<meta property="og:title" content="プロジェクト演習" />
<meta property="og:description" content="A Docsy example sites" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://cu-milab.github.io/ai-robot/project/" /><meta property="og:image" content="https://cu-milab.github.io/ai-robot/project/_print/featured-background.jpg"/><meta property="og:site_name" content="Goldydocs2" />
<meta itemprop="name" content="プロジェクト演習">
<meta itemprop="description" content="A Docsy example sites"><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cu-milab.github.io/ai-robot/project/_print/featured-background.jpg"/>
<meta name="twitter:title" content="プロジェクト演習"/>
<meta name="twitter:description" content="A Docsy example sites"/>




<link rel="preload" href="/ai-robot/scss/main.min.b4f7dfd48b6800b351968ac8471ad4d55805feaf3c41fb97b828337c60db13b1.css" as="style">
<link href="/ai-robot/scss/main.min.b4f7dfd48b6800b351968ac8471ad4d55805feaf3c41fb97b828337c60db13b1.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.3.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VD6HCF8XZQ"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-VD6HCF8XZQ');
}
</script>
  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar navbar-dark js-navbar-scroll">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/ai-robot/"><span class="navbar-brand__logo navbar-logo"></span><span class="navbar-brand__name">中部大学AIロボティクス学科</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/ai-robot/robotics/"><span>ロボティクス演習</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link active" href="/ai-robot/project/"><span>プロジェクト演習</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/ai-robot/ros/"><span>ロボットオペレーティングシステム</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/ai-robot/laboratory/"><span>ロボティクスラボ</span></a>
      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
これは、このセクションの複数ページの印刷可能なビューです。
<a href="#" onclick="print();return false;">印刷するには、ここをクリックしてください</a>.
</p><p>
<a href="/ai-robot/project/">このページの通常のビューに戻る</a>.
</p>
</div>



<h1 class="title">プロジェクト演習</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-12315df1bc93f5b4998f8d90410865a8">Turtlebot3を扱うためのルール</a></li>


    
  
    
    
	
<li>2: <a href="#pg-5a49c0bc07caa56a524f7bcee6a1cbd9">Turtlebot3の動作確認</a></li>


    
  
    
    
	
<li>3: <a href="#pg-c9fb471254764857ca799c9b99d730b8">Turtlebot3の制御</a></li>


    
  
    
    
	
<li>4: <a href="#pg-d8f96d61a96f2816eaab6fcb6d76b5b9">LiDARを用いた障害物検知</a></li>


    
  
    
    
	
<li>5: <a href="#pg-ef2ac564d38cdc95320382b7263403b7">最終課題</a></li>


    
  

    </ul>


<div class="content">
      <h2 id="プロジェクト演習の趣旨">プロジェクト演習の趣旨</h2>
<p>講義の前半では，実機であるTurtlebot3を用いてROS2を実践的に学びます．
後半では，自動運転に見立てたTurtlebot3の自律走行課題に対してグループ単位で取り組み，
問題に対しての思考能力や解決能力，協働学習能力を養います．
講義の最後では，スライドを用いて取り組んだ成果を発表してもらいます．</p>
<h2 id="実習環境">実習環境</h2>
<p>下記の環境で実習することを前提とします．</p>
<ul>
<li>Ubuntu
<ul>
<li>Ubuntu22.04 (デュアルブート環境)</li>
<li>VM環境下で構築されたUbuntu22.04</li>
</ul>
</li>
<li>ROS2 Humble</li>
</ul>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-12315df1bc93f5b4998f8d90410865a8">1 - Turtlebot3を扱うためのルール</h1>
    <div class="lead">Turtlebot3を使用する前に，注意事項を確認します．</div>
	<h2 id="目的">目的</h2>
<p>今後の講義ではTurtlebot3 Burger(以降は簡単化のためTurtlebot3と呼ぶ)を用いて実習を行います．
今回はTurtlebott3を扱う際の注意事項について確認します．</p>
<p><img src="turtlebot3.JPG#center" alt="Turtlebot3"></p>
<h2 id="安全の確保">安全の確保</h2>
<p>実習中の怪我とロボットの故障を防ぐため，下記の点に注意してください．</p>
<ul>
<li>衣服の巻き込み等に対応できる服装を着用すること</li>
<li>ロボットを持ち運ぶ際には，天板部分を持つこと</li>
<li>不用意にセンサー，SDカードを触らないこと</li>
<li>ロボットを持ったままプログラムを実行しないこと</li>
<li>テーブル付き椅子の上にロボットを置かないこと</li>
<li>ロボットを動かす際には周りに声を掛けること</li>
<li>ロボットが予想外の動きをした場合には，即座に停止させること</li>
<li>ロボットが異音，発熱，不審な挙動をした場合には，即座にロボットを停止させ，教員に連絡すること</li>
<li>ロボットがピープ音を発した際には教員に連絡すること</li>
<li>教員の指示に従うこと</li>
</ul>
<h2 id="turtlebot3の基本仕様">Turtlebot3の基本仕様</h2>
<p>Turtlebot3の基本使用は下記の通りです．
注意すべき点は動作時間です．
公式の動作時間は1時間30分となっておりますが，バッテリーの経年劣化の影響で稼働時間が多少短くなります．</p>
<ul>
<li>最高並進速度：0.22 [m/s]</li>
<li>最高各速度：2.84 [rad/s] (162.72[deg/s])</li>
<li>最高積載量：2[kg]</li>
<li>サイズ：138 x 178 x 192 [mm]</li>
<li>重さ：1 [kg]</li>
<li>動作時間：1時間30分程度</li>
<li>充電時間：2時間30分程度</li>
<li>搭載センサ：360° LiDAR，Piカメラ，3軸ジャイロセンサ，3軸加速度センサ，3軸地磁気センサ</li>
</ul>
<h2 id="turtlebot3の構成と電源について">Turtlebot3の構成と電源について</h2>
<p>Turtlebot3は4枚の黒い天板と支柱で構成されています．
最も下の天板にはモーター及びカメラ，2段目の天板にはOpenCR(制御用ボード)，3段目にはRaspberry Pi4(2GB)，4段目にはLiDARが搭載されています．
Turtlebot3の2段目の前方にスライド式の電源スイッチがあります．
電源スイッチをONにすると電源が入り，Raspberry Pi4に挿入されているmicroSDカードからUbuntuが起動します．
その際，LiDARが回転して音がなります．
OSの起動が完了し，Wifiに接続(自動的)されると使用可能な状態になります．</p>
<p><img src="power.JPG#center" alt="電源"></p>
<p>終了する際には，Ubuntuをシャットダウンしてから電源スイッチをオフにする必要があります．
Ubuntuをシャットダウン後，3段目に搭載されているRaspberry Pi上のLEDに注目しましょう．
赤色が電源LED，その隣に緑色のアクセスLEDがあります．
LiDARが停止してアクセスLEDが暫く点灯しない状態になったら電源スイッチをオフにしてください．</p>
<p><img src="power2.JPG#center" alt="電源"></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5a49c0bc07caa56a524f7bcee6a1cbd9">2 - Turtlebot3の動作確認</h1>
    <div class="lead">Turtlebot3を使用方法を学び，動作を確認します．</div>
	<h2 id="目的">目的</h2>
<p>Turtlebot3を使用するための環境を作成し，実機を用いて動作を確認します．
なお，これ以降の講義では2人でペアを作り，1台ずつTurtlebot3を割り当てます．
必ず割り当てられたTurtlebot3を使用してください．</p>
<h2 id="turtlebot3の起動を終了">Turtlebot3の起動を終了</h2>
<p>1ペアに1台のTurtlebot3を割り当てます．
Turtlebot3に機体番号が書かれたシールが貼られていますので，割り当てられたTurtlebot3を使用してください．
なお，実験室には2台の無線LANルーターが設置されていますが，Turtlebot3はどちらか一方のルーターと対応付けされています．
指示された無線LANネットワークに接続してください．</p>
<p>Turtlebot3にはRaspberry Pi4が搭載されており，Ubuntu22.04とROS2 Humbleがインストールされています．
Turtlebot3を使う際には電源スイッチをONにして起動してください．
電源を入れると音がなり，使える準備が整います．
各自のノートPCからsshコマンドにより遠隔操作します．
ターミナルを起動し，下記のようにホスト名(<code>HOST_NAME</code>)を指定して接続します．
ホスト名はTurtlebot3の上部天板に白シールにて書かれています．
ただし，大文字アルファベットは小文字アルファベットに置き換えてください．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ssh ros@<span style="color:#ce5c00;font-weight:bold">{</span>HOST_NAME<span style="color:#ce5c00;font-weight:bold">}</span>.local
</span></span></code></pre></td></tr></table>
</div>
</div><p>上記のコマンドを実行するとパスワードの入力を求められます．
パスワードは講義中に指示します．
sshでTurtlebot3に接続しているターミナルは，ユーザー名<code>ros</code>，ホスト名が<code>HOST_NAME</code>として表示されます．
下記は<code>HOST_NAME</code>が<code>tb01</code>のターミナル表示の例です．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#000;font-style:italic">ros@tb01:~$
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>終了時には，下記のコマンドによりUbuntuをシャットダウンします．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> sudo shutdown now
</span></span></code></pre></td></tr></table>
</div>
</div><p>上記コマンドを実行後，Raspberry Pi4上のアクセスランプ(緑色のLED)が点灯しなくなったら電源スイッチをオフにしてください．</p>
<h2 id="関連ノードの起動">関連ノードの起動</h2>
<p>Turtlebot3の電源を入れた後，ROS2で使うためには下記のコマンドを実行します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="background-color:#dfdfdf"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span></span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 launch turtlebot3_bringup robot.launch.py
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[INFO] [launch]: All log files can be found below /home/ubuntu/.ros/log/2023-11-26-06-55-31-700216-ubuntu-5665
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[INFO] [launch]: Default logging verbosity is set to INFO
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">urdf_file_name : turtlebot3_burger.urdf
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[INFO] [robot_state_publisher-1]: process started with pid [5683]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[INFO] [ld08_driver-2]: process started with pid [5685]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[INFO] [turtlebot3_ros-3]: process started with pid [5687]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] Parsing robot urdf xml string.
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] Link base_link had 5 children
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] Link caster_back_link had 0 children
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] Link imu_link had 0 children
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] Link base_scan had 0 children
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] Link wheel_left_link had 0 children
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] Link wheel_right_link had 0 children
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] [INFO] [1700981732.291499283] [robot_state_publisher]: got segment base_footprint
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] [INFO] [1700981732.292091147] [robot_state_publisher]: got segment base_link
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] [INFO] [1700981732.292191220] [robot_state_publisher]: got segment base_scan
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] [INFO] [1700981732.292227350] [robot_state_publisher]: got segment caster_back_link
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] [INFO] [1700981732.292257386] [robot_state_publisher]: got segment imu_link
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] [INFO] [1700981732.292285553] [robot_state_publisher]: got segment wheel_left_link
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[robot_state_publisher-1] [INFO] [1700981732.292314645] [robot_state_publisher]: got segment wheel_right_link
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981732.336341650] [turtlebot3_node]: Init TurtleBot3 Node Main
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981732.337228530] [turtlebot3_node]: Init DynamixelSDKWrapper
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981732.342895786] [DynamixelSDKWrapper]: Succeeded to open the port(/dev/ttyACM0)!
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981732.351149515] [DynamixelSDKWrapper]: Succeeded to change the baudrate!
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981732.387574044] [turtlebot3_node]: Start Calibration of Gyro
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[ld08_driver-2] /dev/ttyACM0    OpenCR Virtual ComPort in FS Mode
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[ld08_driver-2] /dev/ttyUSB0    CP2102 USB to UART Bridge Controller
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[ld08_driver-2] FOUND LDS-02
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[ld08_driver-2] LDS-02 started successfully
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.387887897] [turtlebot3_node]: Calibration End
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.388057988] [turtlebot3_node]: Add Motors
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.388425725] [turtlebot3_node]: Add Wheels
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.388655167] [turtlebot3_node]: Add Sensors
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.394921324] [turtlebot3_node]: Succeeded to create battery state publisher
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.401007373] [turtlebot3_node]: Succeeded to create imu publisher
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.405075182] [turtlebot3_node]: Succeeded to create sensor state publisher
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.408886217] [turtlebot3_node]: Succeeded to create joint state publisher
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.409021938] [turtlebot3_node]: Add Devices
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.409069622] [turtlebot3_node]: Succeeded to create motor power server
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.414002164] [turtlebot3_node]: Succeeded to create reset server
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.418068177] [turtlebot3_node]: Succeeded to create sound server
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.422146024] [turtlebot3_node]: Run!
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.478917362] [diff_drive_controller]: Init Odometry
</span></span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#000;font-style:italic">[turtlebot3_ros-3] [INFO] [1700981737.494701217] [diff_drive_controller]: Run!
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上記の出力の最後のように<code>RUN!</code>が表示されていればROS2で使える準備が整ったことを表します．</p>
<h2 id="動作確認">動作確認</h2>
<p>上記のlaunchファイルを実行すると複数のノードが起動します．
ROS2で使える状態であるかを確認しましょう．
新たにターミナルを起動して，sshコマンドでTurtlebot3に接続し，
下記のコマンドラインで起動しているノードを確認しましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 node list
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/diff_drive_controller
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/ld08_driver
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/robot_state_publisher
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/turtlebot3_node
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上記のノードが起動していない場合は，正しくlaunchファイルを実行できていない可能性があります．</p>
<p>次に，キーボードによってTurtlebot3を遠隔操作してみましょう．
先ほどと同様に，新たにターミナルを立ち上げ，sshコマンドでTurtlebot3に接続後，
下記のコマンドを実行してください．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 run turtlebot3_teleop teleop_keyboard
</span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">Control Your TurtleBot3!
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">---------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Moving around:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        w
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">   a    s    d
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        x
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">w/x : increase/decrease linear velocity (Burger : ~ 0.22, Waffle and Waffle Pi : ~ 0.26)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">a/d : increase/decrease angular velocity (Burger : ~ 2.84, Waffle and Waffle Pi : ~ 1.82)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">space key, s : force stop
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">CTRL-C to quit
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Turtlesimを動かした時とは異なり，矢印キーではなくアルファベットキーで操作します．</p>
<h2 id="バッテリー残量の確認">バッテリー残量の確認</h2>
<p>Turtlebot3は満充電の状態でおおよそ1時間半ほど使用できます．
使い方によって使用可能時間は前後しますので目安としてください．
バッテリー残量は下記のコマンドで確認することができます．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 topic <span style="color:#204a87">echo</span> /battery_state
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">---
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">header:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  stamp:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    sec: 1710307591
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    nanosec: 971499990
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  frame_id: &#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">voltage: 12.239999771118164
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">temperature: 0.0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">current: 0.0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">charge: 0.0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">capacity: 0.0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">design_capacity: 1.7999999523162842
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">percentage: 96.65999603271484
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">power_supply_status: 0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">power_supply_health: 0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">power_supply_technology: 0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">present: true
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">cell_voltage: []
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">cell_temperature: []
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">location: &#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">serial_number: &#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">---
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>voltage</code>がバッテリー電圧，<code>percentage</code>はバッテリー残量をパーセンテージで表した数値となります．
<code>voltage</code>が約11.1[V]，<code>percentage</code>が約30[%]以下でピープ音を発します．
電圧が10.9[V]付近まで下がるとピープ音が鳴る間隔が短くなりますのでバッテリーの充電が必要です．
ただちに電源をオフにして教員に連絡してください．</p>
<h2 id="データのコピー">データのコピー</h2>
<p>作成したパッケージをノートPCにバックアップを取りたい場合には<code>scp</code>というコマンドを使いましょう．
以下のコマンドはノートPC(sshでTurtlebot3にログインしない)で実行することを想定しています．
また，<code>ssh</code>を実行する際と同様に{HOST_NAME}には，Turtlebot3の上部天板に貼ってある白シールの文字列を入力してください．
ただし，大文字アルファベットは小文字アルファベットに置き換えてください．</p>
<h3 id="turtlebot3からノートpcにパッケージをコピー">Turtlebot3からノートPCにパッケージをコピー</h3>
<p>Turtlebo3にて作成したパッケージ<code>auto_run</code>ディレクトリをノートPCのホームディレクトリにコピーする場合には下記のコマンドを実行します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> scp -r ros@<span style="color:#ce5c00;font-weight:bold">{</span>HOST_NAME<span style="color:#ce5c00;font-weight:bold">}</span>.local:/home/ros/ar20000_ws/src/auto_run ~/
</span></span></code></pre></td></tr></table>
</div>
</div><p>上記はディレクトリをコピーする例ですが，ファイル単体をコピーする場合にはオプションの<code>-r</code>を削除して実行してください．</p>
<h3 id="ノートpcからturtlebot3にパッケージをコピー">ノートPCからTurtlebot3にパッケージをコピー</h3>
<p>ノートPC上のパッケージ<code>auto_run</code>ディレクトリをTurtlebo3にコピーする場合には下記のコマンドを実行します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> scp -r ~/auto_run ros@<span style="color:#ce5c00;font-weight:bold">{</span>HOST_NAME<span style="color:#ce5c00;font-weight:bold">}</span>.local:/home/ros/ar20000_ws/src/
</span></span></code></pre></td></tr></table>
</div>
</div><p>上記はディレクトリをコピーする例ですが，ファイル単体をコピーする場合にはオプションの<code>-r</code>を削除して実行してください．</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c9fb471254764857ca799c9b99d730b8">3 - Turtlebot3の制御</h1>
    <div class="lead">Turtlebot3の自律移動プログラムを実装します．</div>
	<h2 id="目的">目的</h2>
<p>ここまでに学んだことを生かし，Turtlebot3の自律走行プログラムを実装します．
ROS2のコマンドラインで情報を習得して確認する，Python言語に実装するまでを各チーム単位で取り組み，
トピック通信の仕組みから実装までを復習します．</p>
<h2 id="注意点">注意点</h2>
<p>Turtlebot3を用いて作業する場合には，ホームディレクトリにワークスペースを作成してください，
ワークスペースの名前には学籍番号を入れてください．
例えば，<code>er2000_ws</code>等にしてください．</p>
<h2 id="課題">課題</h2>
<p>本講義では課題を順番に解く形式で進めます．課題がどうしても解けない場合には，教員もしくはTAにアドバイスをもらってください．</p>
<h3 id="turtlebot3に関するノードトピックの確認">Turtlebot3に関するノード，トピックの確認</h3>
<ol>
<li><code>turtlebot3_teleop</code>パッケージに含まれる<code>teleop_keyboard</code>を実行し，起動するノード，そのノードが配信，購読するトピックを確認しなさい．</li>
<li>1.で起動したノードが配信するトピックを<code>rostopic echo</code>により購読しなさい．</li>
<li>2.で購読したトピックのメッセージの型及び中身を確認しなさい</li>
<li><code>rostopic pub</code>によりTurtlebot3を前進させなさい</li>
</ol>
<h3 id="turtlebot3の自律移動">Turtlebot3の自律移動</h3>
<ol>
<li>Turtlebot3を自律走行させるためのパッケージを作りなさい．
パッケージ名は自由とします．</li>
<li><a href="./../../ps/tbaet4s/">トピック通信の実装</a>を参考にしてサンプルプログラムを改良し，Turtlebot3を動かしなさい．</li>
<li><a href="./../../ps/tbaet4s/">トピック通信の実装</a>のサンプルプログラムにおける<code>timer_callback</code>関数を削除し，
代わりに<code>setMoveVector</code>関数を初期化メソッド内で実行しなさい．</li>
<li>Turtlebot3で正方形の軌跡を描かせるプログラムを作成しなさい．</li>
</ol>
<h3 id="カメラを用いたセンシング">カメラを用いたセンシング</h3>
<ol>
<li>ロボットオペレーティングの講義にて<a href="./../../ps/yege236/">ROS2による画像処理</a>を学びました．
サンプルプログラムを改良し，白色の通過，黒色の紙を見せたら停止するプログラムを作成しないさい．</li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d8f96d61a96f2816eaab6fcb6d76b5b9">4 - LiDARを用いた障害物検知</h1>
    <div class="lead">LiDARを用いた障害物検知を実装します．</div>
	<h2 id="目的">目的</h2>
<p>Turtlebot3の上部にはLiDAR(Light Detection And Ranging)と呼ばれるセンサが搭載されています．
本講義の前半では座学形式でLiDARの仕組みを学び，後半ではLiDARを用いた障害物検知プログラミングの方法について取り組みます．</p>
<h2 id="turtlebot3に搭載されているlidar">Turtlebot3に搭載されているLiDAR</h2>
<p>Turtlebot3の上部には搭載されているLDS-02は，レーザ光を照射し，対象物に反射した光を受けて計測して距離を測ります．
周囲360°を観測するために，レーザー光の投光及び受光ユニットが機会的に回転します．
LiDARの基本スペックは下記の表の通りです．
詳細なスペックについては<a href="https://emanual.robotis.com/docs/en/platform/turtlebot3/appendix_lds_02/">こちらのページ</a>を参照してください．</p>
<p><img src="LiDAR.JPG#center" alt="LiDAR"></p>
<table>
<thead>
<tr>
<th>LiDAR</th>
<th>スペック</th>
</tr>
</thead>
<tbody>
<tr>
<td>製品名</td>
<td>LDS-02</td>
</tr>
<tr>
<td>レーザー波長</td>
<td>793nm</td>
</tr>
<tr>
<td>安全等級</td>
<td>クラス1</td>
</tr>
<tr>
<td>測定距離</td>
<td>160 ~ 8,000mm</td>
</tr>
<tr>
<td>測定範囲</td>
<td>360°</td>
</tr>
<tr>
<td>測定精度(160 ~ 300mm)</td>
<td>±10mm</td>
</tr>
<tr>
<td>測定精度(300 ~ 6,000mm)</td>
<td>±3.0%</td>
</tr>
<tr>
<td>測定精度(6,000 ~ 8,000mm)</td>
<td>±5.0%</td>
</tr>
<tr>
<td>基本測定分解能</td>
<td>1°</td>
</tr>
<tr>
<td>サイズ</td>
<td>70(W) x 90(D) x 42(H)mm</td>
</tr>
<tr>
<td>重さ</td>
<td>131g</td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">


    Turtlebot3を購入した時期によって搭載されているLiDARの種類が異なります．
今回はLDS-02が搭載されたTurtlebot3を使用します．

</div>

<h2 id="起動とトピックの確認">起動とトピックの確認</h2>
<p>前回の講義と同様に，sshでTurtlebot3にログインし，ROS2で使用するためのノードを起動します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#000;font-style:italic">＄ ros2 launch turtlebot3_bringup robot.launch.py
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>LiDARが配信しているトピックを可視化して見てみましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#000;font-style:italic">＄ ros2 run rviz2 rviz2
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>rviz2が起動したら<code>Display</code>項目の中にある<code>Global Options</code>の<code>Fixed Frame</code>を<code>base link</code>に設定します．
次に左下の<code>Add</code>ボタンをクリックします．
一覧から<code>LaserScan</code>を選択して<code>OK</code>をクリックしてください．
<code>Display</code>に<code>LaserScan</code>が追加されました．
<code>LaserScan</code>をダブルクリックして設定項目を表示します．
<code>Topic</code>が表示されたらダブルクリックしてくさい．
また，<code>Topic</code>にて<code>\scan</code>を選択します．
<code>Topic</code>の中にある<code>Reliability Policy</code>を<code>Reliable</code>から<code>System Default</code>に変更します．
上記の設定でLiDARが配信しているトピックを可視化することができます．
可視化される点群が小さくて見づらい場合には，<code>Size(m)</code>の値を大きくしてください．</p>
<p><img src="rviz.png#center" alt="rviz"></p>
<p>次に，LiDARに関連するノードとトピックを確認しましょう．
まずは起動しているノードを確認します．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 node list
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/diff_drive_controller
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/ld08_driver
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/robot_state_publisher
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/turtlebot3_node
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>LiDARを扱うノードは<code>/ld08_driver</code>です．
どのようなトピックをやり取りしているかを調べます．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 node info /ld08_driver
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">/ld08_driver
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  Subscribers:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /parameter_events: rcl_interfaces/msg/ParameterEvent
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  Publishers:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /parameter_events: rcl_interfaces/msg/ParameterEvent
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /rosout: rcl_interfaces/msg/Log
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /scan: sensor_msgs/msg/LaserScan
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  Service Servers:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /ld08_driver/describe_parameters: rcl_interfaces/srv/DescribeParameters
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /ld08_driver/get_parameter_types: rcl_interfaces/srv/GetParameterTypes
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /ld08_driver/get_parameters: rcl_interfaces/srv/GetParameters
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /ld08_driver/list_parameters: rcl_interfaces/srv/ListParameters
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /ld08_driver/set_parameters: rcl_interfaces/srv/SetParameters
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    /ld08_driver/set_parameters_atomically: rcl_interfaces/srv/SetParametersAtomically
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  Service Clients:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">  Action Servers:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">  Action Clients:
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上記の出力結果からLiDARは，<code>/scan</code>というトピック名で配信されていることが確認できました．
また，メッセージとしては<code>sensor_msgs/msg/LaserScan</code>を使用することが分かります．
配信されるデータの中身を調べてみましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 interface show sensor_msgs/msg/LaserScan
</span></span><span style="display:flex;"><span><span style="color:#8f5902">#</span> Single scan from a planar laser range-finder
</span></span><span style="display:flex;"><span><span style="color:#8f5902">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># If you have another ranging device with different behavior (e.g. a sonar</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902">#</span> array<span style="color:#ce5c00;font-weight:bold">)</span>, please find or create a different message, since applications
</span></span><span style="display:flex;"><span><span style="color:#8f5902">#</span> will make fairly laser-specific assumptions about this data
</span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">std_msgs/Header header # timestamp in the header is the acquisition time of
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">	builtin_interfaces/Time stamp
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">		int32 sec
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">		uint32 nanosec
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">	string frame_id
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                             # the first ray in the scan.
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                             #
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                             # in frame frame_id, angles are measured around
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                             # the positive Z axis (counterclockwise, if Z is up)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                             # with zero angle being forward along the x axis
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">float32 angle_min            # start angle of the scan [rad]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">float32 angle_max            # end angle of the scan [rad]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">float32 angle_increment      # angular distance between measurements [rad]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">float32 time_increment       # time between measurements [seconds] - if your scanner
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                             # is moving, this will be used in interpolating position
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                             # of 3d points
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">float32 scan_time            # time between scans [seconds]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">float32 range_min            # minimum range value [m]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">float32 range_max            # maximum range value [m]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">float32[] ranges             # range data [m]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                             # (Note: values &lt; range_min or &gt; range_max should be discarded)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">float32[] intensities        # intensity data [device-specific units].  If your
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                             # device does not provide intensities, please leave
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                             # the array empty.
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>配信しているデータの種類が多いので少し分かりにくくなっています．
関連するものだけを下記の表にまとめました．</p>
<table>
<thead>
<tr>
<th>変数名</th>
<th>型</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>angle_min</td>
<td>float32</td>
<td>測定範囲の下限</td>
</tr>
<tr>
<td>angle_max</td>
<td>float32</td>
<td>測定範囲の上限</td>
</tr>
<tr>
<td>angle_increment</td>
<td>float32</td>
<td>角度分解能</td>
</tr>
<tr>
<td>ranges</td>
<td>float32の配列</td>
<td>測定した距離</td>
</tr>
</tbody>
</table>
<p>LDS-02は周囲360°の距離を計測可能できますが，サンプリングレートが固定されているため角度分解能がスキャン周波数によって異なります．
そのため，角度の測定範囲の開始が0[rad]ではなく，若干ずれた<code>angle_min</code>[rad]から始まります．
角度分解能はangle_increment[rad]として配信されます．
<img src="./angle.jpg#" width="40%"/></p>
<h2 id="障害物検知プログラム">障害物検知プログラム</h2>
<p>LiDARから配信されたトピックを購読し，前方の障害物までの距離を計測するプログラムを実装します．
下記のサンプルプログラムでは，LiDARで前方30[°]を観測し，障害物までの平均距離を表示します．
これまでに学んだ方法にてワークスペースとパッケージを作成し， 下記のサンプルプログラムを入力してください．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">rclpy</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">rclpy.node</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Node</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sensor_msgs.msg</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">LaserScan</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">math</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">DetectObstacle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Node</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;detect_obstacle_node&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">qos</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">qos</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">QoSProfile</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">depth</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">qos</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">reliability</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">qos</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">QoSReliabilityPolicy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">BEST_EFFORT</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pose_sub</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_subscription</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">LaserScan</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;scan&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">scan_callback</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">qos</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">scan_callback</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">scan</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">angle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">scan</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">angle_min</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">total_distance</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">scan</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ranges</span><span style="color:#000;font-weight:bold">)):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">angle</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">23</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">math</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pi</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#000">angle</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">math</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pi</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">)):</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">scan</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ranges</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">scan</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ranges</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]):</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">total_distance</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">total_distance</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">scan</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ranges</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">angle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">angle</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">scan</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">angle_increment</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">total_distance</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000">cnt</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;[m]&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">init</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">args</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">node</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DetectObstacle</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">spin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">node</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">node</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">destroy_node</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shutdown</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>画像のような環境で実行すると下記のような出力結果が得られます．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> ros2 run detect_obstacle detect_obstacle_node
</span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">0.5146363600817594 [m]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">0.5147878805073824 [m]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">0.5146875071376562 [m]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">0.5159696981545651 [m]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">0.5160294127464294 [m]
</span></span></span></code></pre></td></tr></table>
</div>
</div><img src="./measurement.jpg#" width="40%"/>
<p>プログラムを実行した環境は，LiDARの中心から壁までの最短距離が50.0cm，最長距離が51.8cmでした．
ターミナルに出力した結果は約51.5cmですので，障害物までのおおよその距離を計測できていることがわかります．</p>
<h2 id="プログラムの内容">プログラムの内容</h2>
<p>プログラムの内容を確認しましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">rclpy</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">rclpy.node</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Node</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sensor_msgs.msg</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">LaserScan</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">math</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>必要なモジュールを読み込んでいます．
LiDARから配信されるトピックを購読するために，sensor_msgsパッケージのLaserScanをimportしています．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">DetectObstacle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Node</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;detect_obstacle_node&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">qos</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">qos</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">QoSProfile</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">depth</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">qos</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">reliability</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">qos</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">QoSReliabilityPolicy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">BEST_EFFORT</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pose_sub</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_subscription</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">LaserScan</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;scan&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">scan_callback</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">qos</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>_init__関数内でトピック<code>/scan</code>を購読した際のコールバック関数を定義しています．
これまで扱ってきたサンプルプログラムとは異なり，
今回はQoS(Quality of Service)を設定しています．
QoSは通信品質に関わる設定です．
実環境で運用する場合，通信状況によってはセンサから得られるデータは確実に全てを購読できる訳ではありません．
サンプルプログラムでは，過去<code>10</code>フレームのデータを保存し，<code>Reliability</code>を<code>BEST_EFFORT</code>とします．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>   <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">scan_callback</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">scan</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">angle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">scan</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">angle_min</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">total_distance</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.0</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">scan</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ranges</span><span style="color:#000;font-weight:bold">)):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">angle</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">23</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">math</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pi</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#000">angle</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">math</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pi</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">)):</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">scan</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ranges</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">scan</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ranges</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]):</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">total_distance</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">total_distance</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">scan</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ranges</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">angle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">angle</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">scan</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">angle_increment</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">total_distance</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000">cnt</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;[m]&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>LiDARから配信されるトピックを購読すると<code>scan_callback</code>メソッドが実行されます．
先でも述べたように，LDS-02は周囲360°の距離を1°ずつ測定できますが，
実際にはスキャン周波数によってずれが生じます．
前方30°(23π/12 ~ π/12)までの距離のみを加算し，加算した回数で割ることでLiDARから障害物までの平均距離を計算しています．
ただし，距離が計測できなかった場合には<code>scan.ranges[i]</code>に<code>inf</code>が入っています．
<code>inf</code>まで加算すると平均距離を計算することができなくなるため，<code>inf</code>であった場合には計算から除きます．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">init</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">args</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">node</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DetectObstacle</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">spin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">node</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">node</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">destroy_node</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shutdown</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>main関数は以前と同じ内容ですので省略します．</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ef2ac564d38cdc95320382b7263403b7">5 - 最終課題</h1>
    <div class="lead">自動運転を模した課題に取り組みます．</div>
	<h2 id="目的">目的</h2>
<p>これまでに学んだ内容を生かし，自動運転にちなんだ課題に取り組みます．
課題を介してROSの仕組みの理解やオープンソースソフトウェアとのインテグレーション，プログラミングの実装力，
トライ&amp;エラーによる問題解決，センシング技術など様々なスキルを身につけてください．</p>
<h2 id="課題">課題</h2>
<p>自動運転に模した課題に取り組みます．
課題は基本課題と3つの追加課題で構成されています．
最低でも基本課題をクリアしてから追加課題に取り組みましょう．
コースは下記の写真の通りです．</p>
<p><img src="course.jpg#center" alt="最終課題"></p>
<h3 id="基本課題">基本課題</h3>
<p>黒色のラインを検知し，ラインに沿ってTurtlebot3を走行させます．
スタートからゴールまで黒いラインをトレースして走行させてください．
走行中にTurtlebot3の一部が黒いラインの上にいなければ走行失敗とみなします．</p>
<h3 id="追加課題1">追加課題1</h3>
<p>コース上に設置された徐行標識を認識して走行スピードを低下させてください．
コース上のどの位置からでも標識を認識して良いこととします．
徐行標識を認識後，1秒間以上走行速度を半分以下に制限してください．
標識認識は1回のみとし，2回以上の認識は追加課題の達成失敗とします．</p>
<h3 id="追加課題2">追加課題2</h3>
<p>黒色のライン上に設置された赤色の駐車ラインを認識し，駐車スペースに駐車してください．
駐車動作中はライントレースはしなくても構いません．
駐車スペース用パネルにTurtlebot3の機体半分以上が入り，1秒間以上停止することができれば駐車成功とみなします．
駐車後，黒色のラインに復帰してライントレースを再開してください．</p>
<h3 id="追加課題3">追加課題3</h3>
<p>ゴール用パネルの後ろに設置した障害物を認識し，障害物に衝突する前に停止させてください．
ただし，ゴール用パネル上で停止させてください．
ゴール用パネルにTurtlebot3の機体半分以上が入り，停止することができれば停車成功とみなします．</p>
<h2 id="カメラから得られる画像">カメラから得られる画像</h2>
<p>ライントレースを行うには黒いラインを検知する必要があります．
Turtlebot3に搭載されたカメラは，車体前方の下部に若干下を向くように設置されています．
例えば，下記のようなシーンの場合，黒色のラインが少しだけ観測できます．
最短で約2cm先の黒色のラインを検知できますが，2cm以内のラインは検知できないので注意してください．</p>
<p><img src="turtlebot3_1.jpg#center" alt="turtlebot3_1"></p>
<p><img src="camera1.png#center" alt="image1"></p>
<p>追加課題1では標識を認識する必要があります．
下記のようなシーンでは，解像度は低いですが標識を観測することができます．</p>
<p><img src="turtlebot3_2.jpg#center" alt="turtlebot3_2"></p>
<p><img src="camera2.png#center" alt="image2"></p>
<h2 id="サンプルプログラム">サンプルプログラム</h2>
<p>下記はシンプルなライントレースプログラムです．
黒いラインを検知したら右前に，白いパネルを検知したら左前に進みます．
プログラム自体は新しい内容は含まれていません．
既出のプログラムの組み合わせです．
まずはプログラムを読み理解することから始めましょう．
分からない場合には過去の講義webページを復習してください．</p>
<p>サンプルプログラムでは，直線を上手くライントレースできますが，カーブは上手く曲がることができません．
プログラムを改良して基本課題をクリアしましょう．</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">rclpy</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">cv2</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">np</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">time</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">rclpy.node</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Node</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cv_bridge</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">CvBridge</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">CvBridgeError</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sensor_msgs.msg</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Image</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">geometry_msgs.msg</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Twist</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">std_msgs.msg</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Float32MultiArray</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">math</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">AutoRun</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Node</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">WIDTH</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">40</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">HEIGHT</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">40</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;turtlebot_auto_run&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">twist_pub</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_publisher</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Twist</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;cmd_vel&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">image_sub</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_subscription</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Image</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;/image_raw&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">image_callback</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bridge</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">CvBridge</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">set_move_vector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">linear_x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">angular_z</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">twist</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Twist</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">twist</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">linear</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">linear_x</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">twist</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">angular</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">z</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">angular_z</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">twist_pub</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">twist</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">image_callback</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">try</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">color_image</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bridge</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imgmsg_to_cv2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;bgr8&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">except</span> <span style="color:#000">CvBridgeError</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">e</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_logger</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">e</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">h</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">color_image</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">x1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">w</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">WIDTH</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">x2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">w</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">WIDTH</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">y1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">h</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">HEIGHT</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">y2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">h</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">r</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">g</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y2</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">j</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">x2</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>                <span style="color:#8f5902;font-style:italic">#color_image.itemset((i, j, 0), 0)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#8f5902;font-style:italic">#color_image.itemset((i, j, 1), 0)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">r</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">r</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">color_image</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">item</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">j</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">g</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">g</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">color_image</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">item</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">j</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">color_image</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">item</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">j</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ave_r</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">r</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000;font-weight:bold">((</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">WIDTH</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">HEIGHT</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ave_g</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">g</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000;font-weight:bold">((</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">WIDTH</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">HEIGHT</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ave_b</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000;font-weight:bold">((</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">WIDTH</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">HEIGHT</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ave</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">ave_r</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">ave_g</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">ave_b</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>       
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ave</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set_move_vector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0.05</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1.2</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set_move_vector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0.05</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1.2</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">init</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">args</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">node</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AutoRun</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">spin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">node</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">node</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">destroy_node</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rclpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shutdown</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="参考動画">参考動画</h2>
<p>基本課題と追加課題をクリアした例です．
サンプルプログラムでは，ライントレースの際に機体を左右に降るため滑らかなライントレースができません．
PID制御を導入することで安定した走行が可能となります．
余力がある人は是非取り組んでみてください．

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/WO3EWSNXqdo" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>
</p>

</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
      </div>
      <div class="col-6 col-sm-4 text-end text-xs-center order-sm-3">
        
      </div>
      <div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2">
        <span>&copy; 2025 中部大学理工学部AIロボティクス学科 All Rights Reserved</span>
        
        
      </div>
    </div>
  </div>
</footer>
    </div>
    
  <script src="/ai-robot/js/main.min.ae05c3c7987f6f022b6f7009ca1883a169003bf43e8140e69bff16f181b01c3d.js" integrity="sha256-rgXDx5h/bwIrb3AJyhiDoWkAO/Q&#43;gUDmm/8W8YGwHD0=" crossorigin="anonymous"></script>
<script defer src="/ai-robot/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js" integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin="anonymous"></script>
<script src='/ai-robot/js/tabpane-persist.js'></script>

  </body>
</html>
